<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<script>
  const openReq = indexedDB.open("MyTestDatabase", 7);

  openReq.addEventListener("blocked", function (ev) {
    // 如果其他的一些页签加载了该数据库，在我们继续之前需要关闭它们。
    console.log("请关闭其他打开了该站点的标签页！");
  })
  openReq.onupgradeneeded = (event) => {
    // 其他的数据库已经被关闭，一切就绪。
    const db = event.target.result;
    // db.createObjectStore(/* … */);
    useDatabase(db);
  };

  openReq.onsuccess = (event) => {
    const db = event.target.result;
    useDatabase(db);
    return;
  };

  function useDatabase(db) {
    // 请确保添加了在其他标签页请求了版本变更时会被通知的事件处理器。
    // 我们必须关闭数据库。这允许其他标签页更新数据库。
    // 如果不这样做，在用户关闭这些标签页之前，版本升级将不会发生。
    db.onversionchange = (event) => {
      db.close();
      console.log("此页面的新版本已准备就绪。请重新加载或关闭此标签页！");
    };

    // 处理数据库。
  }
</script>

<body>

</body>

</html>